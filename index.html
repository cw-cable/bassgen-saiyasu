<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
<title>ãƒ™ãƒ¼ã‚¹å¼¦ æœ€å®‰å€¤æ¯”è¼ƒ | ä»Šæ—¥ä¸€ç•ªå®‰ã„ãƒ™ãƒ¼ã‚¹å¼¦ãŒ3ç§’ã§ã‚ã‹ã‚‹</title>
<meta name="description" content="ãƒ™ãƒ¼ã‚¹å¼¦ã®æœ€å®‰å€¤ã‚’ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ¯”è¼ƒã€‚D'Addarioã€Ernie Ballã€Elixirãªã©äººæ°—å‹ç•ªã‚’å„ã‚·ãƒ§ãƒƒãƒ—ã¸ç›´ãƒªãƒ³ã‚¯ã€‚">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Noto+Sans+JP:wght@400;700;900&display=swap" rel="stylesheet">
<style>
  :root {
    --bg: #0a0a0f; --surface: #13131c; --surface2: #1a1a28;
    --accent: #ff2d55; --accent2: #ff6b35; --gold: #ffd700;
    --text: #f0f0f8; --muted: #888; --green: #00e676; --border: #2a2a40;
  }
  * { margin:0; padding:0; box-sizing:border-box; -webkit-tap-highlight-color:transparent; }
  body { background:var(--bg); color:var(--text); font-family:'Noto Sans JP',sans-serif; font-size:14px; line-height:1.4; overflow-x:hidden; }

  /* HEADER */
  header { background:linear-gradient(135deg,#0a0a0f,#13131c); border-bottom:2px solid var(--accent); padding:12px 16px; position:sticky; top:0; z-index:100; display:flex; align-items:center; justify-content:space-between; }
  .logo { font-family:'Bebas Neue',sans-serif; font-size:22px; letter-spacing:2px; color:var(--text); line-height:1; }
  .logo span { color:var(--accent); }
  .logo-sub { font-size:9px; letter-spacing:1px; color:var(--muted); font-weight:400; }
  .update-badge { background:var(--accent); color:white; font-size:9px; font-weight:700; padding:3px 8px; border-radius:3px; letter-spacing:.5px; animation:pulse 2s infinite; }
  @keyframes pulse { 0%,100%{opacity:1} 50%{opacity:.7} }

  /* HERO */
  .hero { background:linear-gradient(180deg,#13131c,#0a0a0f); padding:20px 16px 16px; text-align:center; border-bottom:1px solid var(--border); }
  .hero-headline { font-family:'Bebas Neue',sans-serif; font-size:28px; letter-spacing:2px; line-height:1.1; margin-bottom:6px; }
  .hero-headline em { color:var(--accent); font-style:normal; }
  .hero-sub { font-size:11px; color:var(--muted); }

  /* NAV TABS */
  .nav-tabs { display:flex; gap:6px; padding:12px 16px; overflow-x:auto; scrollbar-width:none; background:var(--surface); border-bottom:1px solid var(--border); position:sticky; top:57px; z-index:90; }
  .nav-tabs::-webkit-scrollbar { display:none; }
  .tab { flex-shrink:0; padding:8px 14px; border-radius:4px; border:1px solid var(--border); background:var(--bg); color:var(--muted); font-size:12px; font-weight:700; cursor:pointer; transition:all .15s; white-space:nowrap; font-family:'Noto Sans JP',sans-serif; }
  .tab.active { background:var(--accent); border-color:var(--accent); color:white; }

  /* SECTION HEADER */
  .section-header { display:flex; align-items:center; gap:8px; padding:14px 16px 8px; }
  .section-title { font-family:'Bebas Neue',sans-serif; font-size:18px; letter-spacing:2px; }
  .section-badge { background:var(--accent); color:white; font-size:9px; font-weight:700; padding:2px 6px; border-radius:2px; }

  /* LOADING / ERROR */
  .loading-wrap { padding:48px 16px; text-align:center; }
  .loading-spinner { width:36px; height:36px; border:3px solid var(--border); border-top-color:var(--accent); border-radius:50%; animation:spin .8s linear infinite; margin:0 auto 16px; }
  @keyframes spin { to{transform:rotate(360deg)} }
  .loading-text { font-size:12px; color:var(--muted); }
  .error-wrap { margin:16px 12px; background:#ff2d5510; border:1px solid #ff2d5540; border-radius:8px; padding:20px 16px; text-align:center; }
  .error-icon { font-size:28px; margin-bottom:8px; }
  .error-text { font-size:12px; color:#ff6b6b; line-height:1.8; }

  /* PRODUCT CARD */
  .products { padding:0 12px 12px; display:flex; flex-direction:column; gap:10px; }
  .product-card { background:var(--surface); border:1px solid var(--border); border-radius:8px; overflow:hidden; position:relative; transition:border-color .2s; animation:slideUp .4s ease both; }
  .product-card:hover { border-color:var(--accent); }
  @keyframes slideUp { from{transform:translateY(20px);opacity:0} to{transform:translateY(0);opacity:1} }

  /* ã‚«ãƒ¼ãƒ‰ãƒ˜ãƒƒãƒ€ãƒ¼ï¼šãƒ–ãƒ©ãƒ³ãƒ‰ï¼†å‹ç•ªã‚’å¤§ãã */
  .card-header { padding:16px 16px 10px; border-bottom:1px solid var(--border); }
  .product-brand-large { font-size:11px; color:var(--accent); letter-spacing:3px; text-transform:uppercase; font-weight:700; margin-bottom:4px; }
  .product-model-large { font-family:'Bebas Neue',sans-serif; font-size:30px; letter-spacing:2px; line-height:1; color:var(--text); }
  .product-tags { display:flex; gap:4px; flex-wrap:wrap; margin-top:8px; }
  .tag { font-size:9px; padding:2px 5px; border-radius:2px; border:1px solid var(--border); color:var(--muted); }
  .tag-nickel { border-color:#4a9eff40; color:#4a9eff; }
  .tag-coated { border-color:#00e67640; color:var(--green); }
  .tag-5str { border-color:#ff6b3540; color:var(--accent2); }

  /* æœ€å®‰å€¤è¡¨ç¤º */
  .card-price-row { display:flex; align-items:center; justify-content:space-between; padding:10px 16px; border-bottom:1px solid var(--border); }
  .price-label { font-size:9px; color:var(--muted); margin-bottom:2px; }
  .price-main { font-family:'Bebas Neue',sans-serif; font-size:36px; color:var(--accent); line-height:1; }
  .price-diff { font-size:11px; font-weight:700; color:var(--green); background:#00e67610; border:1px solid #00e67630; padding:4px 8px; border-radius:3px; }

  /* METER */
  .buy-meter { padding:10px 16px; border-bottom:1px solid var(--border); }
  .meter-label { font-size:10px; color:var(--muted); margin-bottom:6px; display:flex; justify-content:space-between; }
  .meter-track { height:6px; background:var(--surface2); border-radius:3px; overflow:hidden; margin-bottom:4px; }
  .meter-fill { height:100%; border-radius:3px; transition:width 1s ease; }
  .meter-status { font-size:11px; font-weight:700; }
  .status-good{color:var(--green)} .status-avg{color:var(--gold)} .status-high{color:var(--muted)}

  /* å„ã‚·ãƒ§ãƒƒãƒ—ç›´ãƒªãƒ³ã‚¯ãƒœã‚¿ãƒ³ */
  .shop-links { display:flex; flex-direction:column; gap:6px; padding:10px 12px 12px; }
  .shop-link-btn { display:flex; align-items:center; justify-content:space-between; padding:12px 14px; border-radius:6px; border:1px solid var(--border); background:var(--surface2); text-decoration:none; cursor:pointer; transition:all .15s; }
  .shop-link-btn:hover { border-color:var(--accent); background:#ff2d5508; }
  .shop-link-btn.best { border-color:var(--accent); background:#ff2d5512; }
  .shop-link-left { display:flex; align-items:center; gap:10px; }
  .shop-icon-badge { width:30px; height:30px; border-radius:6px; display:flex; align-items:center; justify-content:center; font-size:15px; flex-shrink:0; }
  .shop-icon-amazon { background:#ff9900; }
  .shop-icon-rakuten { background:#bf0000; }
  .shop-icon-sh { background:#1a4c9a; }
  .shop-link-name { font-size:13px; font-weight:700; color:var(--text); }
  .shop-link-note { font-size:10px; color:var(--muted); }
  .shop-link-price { font-family:'Bebas Neue',sans-serif; font-size:22px; }
  .shop-link-price.best-price { color:var(--accent); }
  .shop-link-arrow { font-size:14px; color:var(--muted); margin-left:4px; }

  /* NOTICE */
  .price-notice { background:#ff2d5510; border:1px solid #ff2d5530; border-radius:4px; padding:8px 12px; margin:0 12px 12px; font-size:10px; color:#ff6b6b; display:flex; align-items:center; gap:6px; }

  /* BOTTOM */
  .bottom-info { padding:16px; font-size:10px; color:var(--muted); line-height:1.8; text-align:center; border-top:1px solid var(--border); }
</style>
</head>
<body>

<header>
  <div>
    <div class="logo">BASS<span>æœ€å®‰</span>.COM</div>
    <div class="logo-sub">ãƒ™ãƒ¼ã‚¹å¼¦ æœ€å®‰å€¤æ¯”è¼ƒ</div>
  </div>
  <div class="update-badge" id="updateBadge">ğŸ”´ èª­ã¿è¾¼ã¿ä¸­...</div>
</header>

<div class="hero">
  <div class="hero-headline">ä»Šæ—¥ä¸€ç•ªå®‰ã„<br><em>ãƒ™ãƒ¼ã‚¹å¼¦</em>ãŒ3ç§’ã§ã‚ã‹ã‚‹</div>
  <div class="hero-sub">Amazonãƒ»æ¥½å¤©ãƒ»ã‚µã‚¦ãƒ³ãƒ‰ãƒã‚¦ã‚¹ã‚’æ¯æ—¥æ¯”è¼ƒ</div>
</div>

<div class="nav-tabs" id="brandTabs">
  <div class="tab active" onclick="filterBrand('all',this)">ã™ã¹ã¦</div>
</div>

<div class="section-header">
  <span class="section-title">ğŸ¸ ãƒ™ãƒ¼ã‚¹å¼¦ ä¾¡æ ¼æ¯”è¼ƒ</span>
  <span class="section-badge" id="updatedAt">æ›´æ–°ä¸­</span>
</div>

<div class="price-notice">
  âš ï¸ ä¾¡æ ¼ã¯éšæ™‚å¤‰å‹•ã—ã¾ã™ã€‚ãƒªãƒ³ã‚¯å…ˆã§æœ€çµ‚ä¾¡æ ¼ã‚’å¿…ãšã”ç¢ºèªãã ã•ã„ã€‚
</div>

<div class="products" id="productList">
  <div class="loading-wrap">
    <div class="loading-spinner"></div>
    <div class="loading-text">ä¾¡æ ¼æƒ…å ±ã‚’å–å¾—ã—ã¦ã„ã¾ã™...</div>
  </div>
</div>

<div class="bottom-info">
  ä¾¡æ ¼æƒ…å ±ã¯ææºã‚µãƒ¼ãƒ“ã‚¹ã‹ã‚‰å–å¾—ã—ã¦ã„ã¾ã™ã€‚æœ€çµ‚ä¾¡æ ¼ã¯ãƒªãƒ³ã‚¯å…ˆã§ã”ç¢ºèªãã ã•ã„ã€‚<br>
  å½“ã‚µã‚¤ãƒˆã¯Amazonã‚¢ã‚½ã‚·ã‚¨ã‚¤ãƒˆãƒ»æ¥½å¤©ã‚¢ãƒ•ã‚£ãƒªã‚¨ã‚¤ãƒˆãƒ»ã‚µã‚¦ãƒ³ãƒ‰ãƒã‚¦ã‚¹ã‚¢ãƒ•ã‚£ãƒªã‚¨ã‚¤ãƒˆãƒ—ãƒ­ã‚°ãƒ©ãƒ ã«å‚åŠ ã—ã¦ã„ã¾ã™ã€‚<br><br>
  <a href="#" style="color:var(--muted)">é‹å–¶è€…æƒ…å ±</a> | <a href="#" style="color:var(--muted)">ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ãƒãƒªã‚·ãƒ¼</a>
</div>

<script>
// ============================================================
// â–¼â–¼â–¼ ã“ã“ã ã‘æ›¸ãæ›ãˆã¦ãã ã•ã„ â–¼â–¼â–¼
const GAS_URL = 'https://script.google.com/macros/s/AKfycbw9AP4GaFVIsH1zwwiYqT74TSoIZL2tiMQdX3qtcZZVhjgSM8ytitpRPiTsizsIKW41xg/exec';
// â–²â–²â–² GASãƒ‡ãƒ—ãƒ­ã‚¤å¾Œã«ç™ºè¡Œã•ã‚Œã‚‹URLã‚’ã“ã“ã«è²¼ã‚‹ â–²â–²â–²
// ============================================================

let allProducts   = [];
let currentBrand  = 'all';

/* ---------- ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ ---------- */
const fmtPrice = n => (!n || isNaN(n)) ? 'â€”' : 'Â¥' + Number(n).toLocaleString();

const shopMeta = name => {
  if (name.includes('Amazon')) return { icon:'ğŸ›’', cls:'shop-icon-amazon', label:'Amazon' };
  if (name.includes('æ¥½å¤©'))   return { icon:'ğŸ¦…', cls:'shop-icon-rakuten', label:'æ¥½å¤©å¸‚å ´' };
  return { icon:'ğŸ¸', cls:'shop-icon-sh', label:'ã‚µã‚¦ãƒ³ãƒ‰ãƒã‚¦ã‚¹' };
};

/* ---------- è²·ã„åˆ¤å®š ---------- */
function calcJudge(now, low30, avg30) {
  if (!low30 || !avg30) return { cls:'judge-avg', icon:'âš–ï¸', label:'â—‹ å‚è€ƒä¾¡æ ¼' };
  const ratio = (now - low30) / ((avg30 - low30) || 1);
  if (ratio <= 0.3) return { cls:'judge-good', icon:'ğŸ”¥', label:'â— ä»ŠãŒç‹™ã„ç›®ï¼' };
  if (ratio <= 0.7) return { cls:'judge-avg', icon:'âš–ï¸', label:'â—‹ å¹³å‡æ°´æº–' };
  return { cls:'judge-high', icon:'â³', label:'â–³ ã‚„ã‚„é«˜ã‚' };
}

function meterPct(now, low30, avg30) {
  if (!low30 || !avg30 || avg30 === low30) return 50;
  return Math.min(100, Math.max(5, Math.round((1 - (now-low30)/(avg30-low30)) * 100)));
}
const meterColor = p => p >= 70
  ? 'linear-gradient(90deg,#00e676,#4aff8c)'
  : p >= 40 ? 'linear-gradient(90deg,#ffd700,#ffee88)'
  : 'linear-gradient(90deg,#888,#aaa)';

/* ---------- ã‚«ãƒ¼ãƒ‰ç”Ÿæˆ ---------- */
function buildCard(p, idx) {
  const shops = [
    { name:'Amazon',        price: Number(p.amazon_price),     url: p.amazon_url },
    { name:'æ¥½å¤©å¸‚å ´',      price: Number(p.rakuten_price),    url: p.rakuten_url },
    { name:'ã‚µã‚¦ãƒ³ãƒ‰ãƒã‚¦ã‚¹',price: Number(p.soundhouse_price), url: p.soundhouse_url },
  ].filter(s => s.price > 0).sort((a,b) => a.price - b.price);

  const cheapest = shops[0]?.price || 0;
  const low30    = Number(p.low30)  || 0;
  const avg30    = Number(p.avg30)  || cheapest;
  const pct      = meterPct(cheapest, low30, avg30);
  const judge    = calcJudge(cheapest, low30, avg30);
  const diffAmt  = Math.round(avg30 - cheapest);
  const statusCls= judge.cls === 'judge-good' ? 'status-good' : judge.cls === 'judge-high' ? 'status-high' : 'status-avg';

  const shopLinksHtml = shops.map((s, i) => {
    const meta = shopMeta(s.name);
    return `<a href="${s.url || '#'}" class="shop-link-btn ${i===0?'best':''}" onclick="event.stopPropagation()" target="_blank" rel="noopener">
      <div class="shop-link-left">
        <div class="shop-icon-badge ${meta.cls}">${meta.icon}</div>
        <div>
          <div class="shop-link-name">${meta.label}</div>
          <div class="shop-link-note">${i===0?'âœ… æœ€å®‰å€¤':'é€šå¸¸ä¾¡æ ¼'}</div>
        </div>
      </div>
      <div style="display:flex;align-items:center;gap:4px;">
        <div class="shop-link-price ${i===0?'best-price':''}">${fmtPrice(s.price)}</div>
        <div class="shop-link-arrow">â†’</div>
      </div>
    </a>`;
  }).join('');

  const tagHtml = (p.tags||'').split(',').map(t=>t.trim()).filter(Boolean).map(t => {
    const cls = t==='ã‚³ãƒ¼ãƒ†ã‚£ãƒ³ã‚°'?'tag-coated':t==='ãƒ‹ãƒƒã‚±ãƒ«'?'tag-nickel':t==='5å¼¦'?'tag-5str':'';
    return `<span class="tag ${cls}">${t}</span>`;
  }).join('');

  return `<div class="product-card" data-brand="${(p.brand||'').toLowerCase()}" style="animation-delay:${idx*.08}s">
    <div class="card-header">
      <div class="product-brand-large">${p.brand}</div>
      <div class="product-model-large">${p.model}</div>
      <div class="product-tags">${tagHtml}</div>
    </div>
    <div class="card-price-row">
      <div>
        <div class="price-label">ä»Šæ—¥ã®æœ€å®‰å€¤</div>
        <div class="price-main">${fmtPrice(cheapest)}</div>
      </div>
      ${diffAmt > 0 ? `<div class="price-diff">â–¼ ${diffAmt.toLocaleString()}å††ãŠå¾—</div>` : ''}
    </div>
    <div class="buy-meter">
      <div class="meter-label">
        <span>30æ—¥æœ€å®‰å€¤ãƒ¬ãƒ™ãƒ«</span>
        <span>éå»æœ€å®‰ï¼š${fmtPrice(low30)}</span>
      </div>
      <div class="meter-track">
        <div class="meter-fill" style="width:${pct}%;background:${meterColor(pct)};"></div>
      </div>
      <div class="meter-status ${statusCls}">${judge.icon} ${judge.label}</div>
    </div>
    <div class="shop-links">${shopLinksHtml}</div>
  </div>`;
}

/* ---------- ãƒ–ãƒ©ãƒ³ãƒ‰ã‚¿ãƒ–ç”Ÿæˆ ---------- */
function buildBrandTabs(products) {
  const brands = [...new Set(products.map(p => p.brand).filter(Boolean))];
  const tabsEl = document.getElementById('brandTabs');
  brands.forEach(brand => {
    const tab = document.createElement('div');
    tab.className = 'tab';
    tab.textContent = brand;
    tab.onclick = function() { filterBrand(brand.toLowerCase(), this); };
    tabsEl.appendChild(tab);
  });
}

/* ---------- ä¸€è¦§æç”» ---------- */
function renderList(brand) {
  const list = document.getElementById('productList');
  const filtered = brand === 'all'
    ? allProducts
    : allProducts.filter(p => (p.brand||'').toLowerCase() === brand);
  if (!filtered.length) {
    list.innerHTML = `<div class="error-wrap"><div class="error-icon">ğŸ“­</div>
      <div class="error-text">ã“ã®æ¡ä»¶ã®å•†å“ãŒã¾ã ã‚ã‚Šã¾ã›ã‚“</div></div>`;
    return;
  }
  list.innerHTML = filtered.map((p,i) => buildCard(p,i)).join('');
}

/* ---------- ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ ---------- */
function filterBrand(brand, el) {
  currentBrand = brand;
  document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
  el.classList.add('active');
  renderList(brand);
}

/* ---------- èµ·å‹•ï¼šGASã‹ã‚‰ãƒ‡ãƒ¼ã‚¿å–å¾— ---------- */
(async () => {
  const badge     = document.getElementById('updateBadge');
  const updatedAt = document.getElementById('updatedAt');

  let data = null;
  try {
    const res = await fetch(GAS_URL);
    if (!res.ok) throw new Error('HTTP ' + res.status);
    data = await res.json();
  } catch(e) {
    console.error(e);
  }

  if (!data?.products?.length) {
    document.getElementById('productList').innerHTML = `
      <div class="error-wrap">
        <div class="error-icon">âš ï¸</div>
        <div class="error-text">
          ä¾¡æ ¼ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã§ãã¾ã›ã‚“ã§ã—ãŸã€‚<br>
          <strong>GAS_URL</strong> ãŒæ­£ã—ãè¨­å®šã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèªã—ã¦ãã ã•ã„ã€‚<br><br>
          è¨­å®šæ‰‹é †ã¯åŒæ¢±ã® <strong>readme.txt</strong> ã‚’ã”è¦§ãã ã•ã„ã€‚
        </div>
      </div>`;
    badge.textContent = 'âš ï¸ å–å¾—ã‚¨ãƒ©ãƒ¼';
    return;
  }

  allProducts = data.products;
  buildBrandTabs(allProducts);

  const ts = data.updated_at
    ? new Date(data.updated_at).toLocaleDateString('ja-JP',{month:'numeric',day:'numeric',hour:'2-digit',minute:'2-digit'})
    : 'æ›´æ–°æ¸ˆ';
  badge.textContent   = 'ğŸ”´ LIVEæ›´æ–°ä¸­';
  updatedAt.textContent = ts + ' æ›´æ–°';
  renderList(currentBrand);
})();
</script>
</body>
</html>
